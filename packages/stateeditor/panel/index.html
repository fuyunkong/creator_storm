<!DOCTYPE html>
<html lang="en" ng-app="app">
<head>

    <meta charset="UTF-8">
    <title>状态编辑器</title>
    <script type="text/javascript" src="../node_modules/vis/dist/vis.js"></script>
    <!--<script type="text/javascript" src="../node_modules/storejs/dist/store.js"></script>-->
    <script type="text/javascript" src="../node_modules/store/store.js"></script>
    <script type="text/javascript" src="js/sql.js"></script>


    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="../lib/jquery.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    <script>
			window.$ = window.jQuery = require('../lib/jquery.min.js');
			require('../node_modules/bootstrap/dist/js/bootstrap.min.js');
    </script>












    <link href="../node_modules/vis/dist/vis-network.min.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 650px;
            border: 2px solid lightgray;
        }
    </style>
</head>
<body ng-controller="app_control">
<div class="container">

    <h3><span class="label label-default">状态编辑器</span></h3>

    <div class="row">

        <div class="col-md-2" style="background-color: #fff0ff;box-shadow:
         inset 1px -1px 1px #444, inset -1px 1px 1px #444;">

            <h4><span class="label label-default">项目管理</span></h4>
            <folder-tree current-item="silde_data"></folder-tree>

        </div>

        <div class="col-md-10" style="background-color: #fff0ff;box-shadow:inset 1px -1px 1px #444, inset -1px 1px 1px #444;">


            <h5><span class="label label-default">{{name}}</span></h5>
            <div class="col-md-12" style="background-color: #fff0ff;box-shadow:inset 1px -1px 1px #444, inset -1px 1px 1px #444;height: 80px">
                <!--<h5><span class="label label-default">功能说明</span></h5>-->
                <div class="col-md-4 btn-group" style="background-color: #fff0ff;box-shadow:inset 1px -1px 1px #444, inset -1px 1px 1px #444;">
                    <button type="button" class="btn btn-info" onclick="node_add()">addNode</button>
                    <button type="button" class="btn btn-info" onclick="node_load()">load</button>
                    <button type="button" class="btn btn-info" onclick="node_save()">save</button>
                    <button type="button" class="btn btn-info" ng-click="toJson(data)">toJson</button>
                    <button type="button" class="btn btn-info" onclick="edge_testadd()">addEdge</button>
                </div>
                <!--<div class="col-md-1 btn-group" style="background-color: #fff0ff;box-shadow:inset 1px -1px 1px #444, inset -1px 1px 1px #444;">-->

                <!--</div>-->
                <div class="col-md-8 " style="background-color: #fff0ff;box-shadow:inset 1px -1px 1px #444, inset -1px 1px 1px #444;height: 80px">
                    <form class="form-inline" role="form"  ng-show="selectnode">
                        <div class="input-group">
                            <span class="input-group-addon">状态</span>
                            <input type="text" class="form-control" ng-model="selectnode.label" placeholder="node_name">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon">描述</span>
                            <input type="text" class="form-control" ng-model="selectnode.des"  placeholder="node_des">
                        </div>
                        <button type="button" class="btn btn-info" ng-click="node_update()">更新</button>

                    </form>
                    <form class="form-inline" role="form"  ng-show="selectEdge">
                        <div class="input-group">
                            <span class="input-group-addon">事件</span>
                            <input type="text" class="form-control" ng-model="selectEdge.label" placeholder="node_name">
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon">描述</span>
                            <input type="text"
                                   class="form-control"
                                   ng-model="selectEdge.des"
                                   placeholder="node_des">
                        </div>


                        <div class="input-group">
                            <span class="input-group-addon">起点</span>
                            <select class="form-control"
                                    ng-model="selectEdge_from"
                                    ng-change="selectChange(selectEdge_from,0)"
                                    ng-options="x.label for x in data.nodesArray">
                            </select>
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon">终点</span>
                            <select type="text"
                                    class="form-control"
                                    ng-model="selectEdge_to"
                                    ng-change="selectChange(selectEdge_to,1)"
                                    ng-options="x.label for x in data.nodesArray">
                            </select>

                            <!--<h5>你选择的是: {{selectedSite.site}}</h5>-->
                            <!--<h5>网址为: {{selectedSite.url}}</h5>-->
                        </div>
                        <button type="button" class="btn btn-info" ng-click="node_update()">更新</button>

                    </form>
                </div>


            </div>
            <div class="col-md-12" >
                <div id="mynetwork"></div>
            </div>




            </div>
    </div>

</div>






<!-- angularjs库 -->
<script src="../lib/angularjs1.6.1/angular.js"></script>

<script src="../lib/ArrayExtend.js"></script>

<script type="text/javascript" src="js/app.js"></script>
<script type="text/javascript" src="js/control/TreeControl.js"></script>

<script type="text/javascript" >

	network = new vis.Network(container, data, options);

	network.on("click", function (params) {
		params.event = "[original event]";
//	  console.log(JSON.stringify(params, null, 4));

	});

	network.on("doubleClick", function (params) {
		params.event = "doubleClick";
//		console.log(JSON.stringify(params, null, 4));
        $app_control.onSelectNode();
        var obj = params.nodes[0];
        node_save();
        $app_control.onNode(obj);
        $app_control.$apply();
//		$app_control.toJson(params);
	});

	network.on("select", function (params) {
//	  console.log('select Event:', params);
//		console.log(toJSON(params));
        $app_control.selectAll = params;
//			console.log(nodes);
//			console.log(edges);
	});

	  network.on("selectNode", function (params) {
		  console.log('selectNode:', params);
//		  console.log(JSON.stringify(params, null, 4));

          $app_control.onSelectNode();
		  var obj = params.nodes[0];
//		  console.log(JSON.stringify(obj));
		  node_save();
		  $app_control.onNode(obj);
		  $app_control.$apply();
	  });

	//
	  network.on("selectEdge", function (params) {
		  console.log('selectEdge:', params);
//		  console.log(JSON.stringify(params, null, 4));
          $app_control.onSelectEdge();
          var obj = params.edges[0];
		  node_save();
		  $app_control.onEdge(obj);
		  $app_control.$apply();

	  });

	  network.on("deselectNode", function (params) {
//		  console.log('deselectNode Event:', params);
		  node_save();
		  $app_control.ondeSelectNode();
		  $app_control.$apply();
	  });
      network.on("deselectEdge", function (params) {
//		console.log('deselectEdge Event:', params);
	      node_save();
	      $app_control.ondeSelectEdge();
	      $app_control.$apply();
      });
		network.on("dragEnd", function (params) {
            node_save();
		});

		function keydown() {
			var keycode = event.keyCode;
//			var realkey = String.fromCharCode(event.keyCode);
			tolog(keycode);
			if(keycode===46){
               $app_control.key_delete();
            }

		}
		document.onkeydown=keydown;


</script>



</body>
</html>